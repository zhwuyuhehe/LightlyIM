import{d as L,k as b,l as f,e as h,w as a,r as m,u as x,j as F,a as s,m as k,b as E,g as c,E as w,n as U,_ as M}from"./index-7JKY8DTR.js";import{P as R}from"./Interactive-NSA2erjS.js";import{C as S}from"./CaptchaCode-DIKGrsDY.js";import{u as B}from"./user-CG2YVqeJ.js";import{u as $}from"./UseWebSocket-DqfMbmIh.js";const j={style:{display:"flex","text-align":"center","justify-items":"center","align-items":"center",margin:"0 auto"}},I=L({__name:"LoginForm",setup(K){const g=x(),C=B(),_=$(),l=b(),v=t=>{t&&t.resetFields()},r=f({username:"",password:"",confirmNum:""});let i;const y=t=>{i=t,l.value&&r.confirmNum&&l.value.validateField("confirmNum")},N=f({username:[{validator:(t,e,o)=>{if(e){if(r.username.length>32||r.username.length<4)return o(new Error("用户名长度需要在4~32之间！"))}else return o(new Error("请输入用户名！"));o()},trigger:"blur"}],password:[{validator:(t,e,o)=>{if(e){if(e.length<4||e.length>16)return o(new Error("请输入4~16位密码！"))}else return o(new Error("请输入密码！"));o()},trigger:"blur"}],confirmNum:[{validator:(t,e,o)=>{if(e){if(e.toLowerCase()!==i.toLowerCase())return o(new Error(e.toLowerCase()+"请输入正确的验证码！"+i.toLowerCase()))}else return o(new Error("请输入验证码！"));o()},trigger:"blur"}]}),d=t=>{t&&t.validate(e=>{e?R({url:"/login",data:{email:r.username,password:r.password}}).then(o=>{w({title:"展示返回值",message:o.data,type:"success"}),o.data.code===200&&(C.setUserInfo(o.data.user),U.success(o.data.message),_.connect(),g.push("/Modification"))}).catch(o=>{console.error(o)}):w({title:"提交错误！",message:"未按规定填写内容",type:"warning"})})};return(t,e)=>{const o=m("el-input"),u=m("el-form-item"),p=m("el-button"),V=m("el-form");return F(),h(V,{"label-position":"top","label-width":"auto",ref_key:"LoginFormRef",ref:l,model:r,rules:N},{default:a(()=>[s(u,{label:"用户",prop:"username"},{default:a(()=>[s(o,{clearable:"",placeholder:"请输入用户名",modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=n=>r.username=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),s(u,{label:"密码",prop:"password"},{default:a(()=>[s(o,{"show-password":"",clearable:"",placeholder:"请输入密码",type:"password",modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=n=>r.password=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),s(u,{label:"验证码",prop:"confirmNum"},{default:a(()=>[s(o,{clearable:"",placeholder:"请输入验证码",modelValue:r.confirmNum,"onUpdate:modelValue":e[2]||(e[2]=n=>r.confirmNum=n),autocomplete:"off",onKeydown:e[3]||(e[3]=k(n=>d(l.value),["enter"]))},{append:a(()=>[s(S,{onGetCaptchaCode:y})]),_:1},8,["modelValue"])]),_:1}),s(u,null,{default:a(()=>[E("div",j,[s(p,{type:"primary",onClick:e[4]||(e[4]=n=>d(l.value))},{default:a(()=>e[6]||(e[6]=[c("登录")])),_:1}),s(p,{onClick:e[5]||(e[5]=n=>v(l.value))},{default:a(()=>e[7]||(e[7]=[c("重置")])),_:1})])]),_:1})]),_:1},8,["model","rules"])}}}),H=M(I,[["__scopeId","data-v-cf79cee2"]]);export{H as default};
