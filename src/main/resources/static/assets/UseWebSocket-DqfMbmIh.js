import{G as f,k as a}from"./index-7JKY8DTR.js";const y=f("WebSocket",()=>{const s=a(null),l=a(!1),c=a([]),u=a([]),r=a([]),i=a([]);return{socket:s,isConnected:l,messageQueue:c,messages:u,systemMessages:r,connect:()=>{if(s.value)return;const n="ws://localhost:8080/ws";s.value=new WebSocket(n),s.value.onopen=()=>{l.value=!0,console.log("WS Connected"),c.value.forEach(e=>{var t;return(t=s.value)==null?void 0:t.send(e)}),c.value=[]},s.value.onmessage=async e=>{let t;if(typeof e.data=="string")t=e.data;else if(e.data instanceof Blob)t=await e.data.text();else if(e.data instanceof ArrayBuffer)t=new TextDecoder().decode(e.data);else{console.error("消息格式错误",e.data);return}try{const o=JSON.parse(t);o.type==="system"?r.value.push(o.content):o.type==="chat"?u.value.push(o):o.type==="online"&&(i.value=o.online),console.log("WS Message: ",o)}catch(o){console.error("无法解析消息",t,o)}},s.value.onclose=()=>{l.value=!1,s.value=null,console.log("WS 链接已断开")},s.value.onerror=e=>{console.warn("WS error:",e)}},sendMsg:n=>{const e=typeof n=="string"?n:JSON.stringify(n);s.value&&l.value?s.value.send(e):c.value.push(e)},disconnect:()=>{var n;(n=s.value)==null||n.close(),s.value=null,l.value=!1},onlineCount:i}});export{y as u};
